<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>++SD MANAGEMENT TERMINAL++</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

  body {
    background: black;
    color: white;
    font-family: 'Share Tech Mono', monospace;
    padding: 20px;
    user-select: none;
  }
  #terminal {
    white-space: pre-wrap;
    line-height: 1.3em;
    max-width: 800px;
    margin: auto;
    min-height: 400px;
  }
  #terminal-output {
    margin-bottom: 12px;
  }
  #terminal-input {
    display: none;
  }
  .hidden {
    display: none;
  }
  input[type="password"], input[type="text"] {
    background: black;
    border: 1px solid white;
    color: white;
    font-family: inherit;
    font-size: 1em;
    padding: 6px 10px;
    width: 300px;
  }
  button {
    background: none;
    border: 1px solid white;
    color: white;
    padding: 8px 16px;
    font-family: inherit;
    cursor: pointer;
    margin-top: 12px;
  }
  button:hover {
    background: white;
    color: black;
  }
  a {
    color: #66f;
  }
</style>
</head>
<body>

<div id="terminal">
  <div id="terminal-output"></div>
  <div id="terminal-input"></div>
</div>

<script>
  const terminalOutput = document.getElementById("terminal-output");
  const terminalInputContainer = document.getElementById("terminal-input");

  const agents = {
    "RATCHET": "https://docs.google.com/document/d/19y8PjZXeLRLeM5YRb2OrC5P0a-y_LOkVk4Qapm9vlTI/edit",
    "CHINATSU": "https://docs.google.com/document/u/0/d/1_EHJ-ut4quezxCJSCrMR4vzMZpouqms10R9xtZA5tUY/mobilebasic",
    "AEGIS": "https://docs.google.com/document/d/1u4WypRconLkVQl2Kpyfo_-relGRMSm6kDn3RW5pOSqw/edit",
    "ULGRIN": "https://docs.google.com/document/d/1ihlLNXQDcQJWf-G8_ok3o8gZuD7j6ADwehyaVd29atw/edit",
    "BOBO": "https://docs.google.com/document/d/1Pe9M_jB5Ak95i-uoy9_3GvBNYkqAnEjyPIlboQxP7pE/edit",
    "CAELUM": "blocked",
    "BELL": "https://docs.google.com/document/d/1lhK-biGd6koGAMax01xtLYSweqGb8fm4fWI4RyZSdMM/edit",
    "EAGLE": "https://docs.google.com/document/d/1lhK-biGd6koGAMax01xtLYSweqGb8fm4fWI4RyZSdMM/edit"
  };

  let inputCallback = null;
  let passcode = "123456";
  let lastSelectedAgent = "";

  // Helper to append text to terminal output
  function appendOutput(text = "") {
    terminalOutput.innerText += text + "\n";
    terminalOutput.scrollTop = terminalOutput.scrollHeight;
  }

  // Print lines with delay, returns a Promise to await
  function printLines(lines, delay=30) {
    return new Promise(resolve => {
      let i = 0;
      function printNext() {
        if(i < lines.length){
          appendOutput(lines[i]);
          i++;
          setTimeout(printNext, delay);
        } else {
          resolve();
        }
      }
      printNext();
    });
  }

  // Clear terminal
  function clearTerminal() {
    terminalOutput.innerText = "";
    terminalInputContainer.innerHTML = "";
    terminalInputContainer.style.display = "none";
  }

  // Show input box with prompt, handle enter key
  function promptInput(promptText, callback, isPassword=false) {
    appendOutput(promptText);
    terminalInputContainer.innerHTML = "";
    terminalInputContainer.style.display = "block";
    const input = document.createElement("input");
    input.type = isPassword ? "password" : "text";
    input.autofocus = true;
    terminalInputContainer.appendChild(input);
    input.focus();

    function submit() {
      const val = input.value.trim();
      if(val === "") return;
      appendOutput(val);
      terminalInputContainer.innerHTML = "";
      terminalInputContainer.style.display = "none";
      callback(val);
    }

    input.addEventListener("keydown", e => {
      if(e.key === "Enter"){
        e.preventDefault();
        submit();
      }
    });
  }

  async function startTerminal(){
    clearTerminal();
    await printLines([
      "++SD MANAGEMENT TERMINAL++",
      "———————————————————",
      "WARNING:",
      "YOU ARE ENTERING A RESTRICTED PROGRAM.",
      "",
      "PLEASE COMPLETE THE CAPTCHA GIVEN.",
      "…"
    ]);

    // Show CAPTCHA button separately
    const captchaBtn = document.createElement("button");
    captchaBtn.textContent = "Complete CAPTCHA";
    terminalInputContainer.appendChild(captchaBtn);
    terminalInputContainer.style.display = "block";

    captchaBtn.onclick = async () => {
      captchaBtn.disabled = true;
      terminalInputContainer.style.display = "none";
      appendOutput("\n…");
      await new Promise(r => setTimeout(r, 600));
      appendOutput("…");
      await new Promise(r => setTimeout(r, 600));
      appendOutput("…");
      await new Promise(r => setTimeout(r, 600));

      await printLines([
        "CAPTCHA COMPLETED.",
        "",
        "PLEASE VERIFY AND ENTER YOUR CREDENTIALS.",
        "…",
        "STANDBY FOR VERIFICATION…",
        "…",
        "USER FOUND..",
        "CHECKING ACCESS LEVEL..",
        "…",
        "ACCESS LEVEL UP TO CODE",
        "VERIFYING…",
        "…",
        "AUTHORIZED. PROCEED.",
        "———————————————————",
        "WELCOME.",
        "",
        "SELECT CATEGORY",
        ">PERSONNEL",
        ">DATABASE",
        ">DIPLOMACY",
        ""
      ]);
      showMainMenu();
    };
  }

  // Main menu
  function showMainMenu(){
    promptInput("> ", (choice) => {
      const c = choice.toUpperCase();
      if(c === "PERSONNEL") {
        showPersonnelMenu();
      } else if(c === "DATABASE"){
        appendOutput("DATABASE not implemented yet.\n");
        showMainMenu();
      } else if(c === "DIPLOMACY"){
        appendOutput("DIPLOMACY not implemented yet.\n");
        showMainMenu();
      } else {
        appendOutput("INVALID OPTION. TRY AGAIN.\n");
        showMainMenu();
      }
    });
  }

  // Personnel menu
  function showPersonnelMenu(){
    clearTerminal();
    appendOutput("PERSONNEL SELECTED\n");
    appendOutput("PLEASE SELECT FILE");
    Object.keys(agents).forEach(agent => appendOutput(">" + agent));
    appendOutput(">NEXT PAGE..\n");

    promptInput("> ", (sel) => {
      const selection = sel.toUpperCase();
      if(selection === "NEXT PAGE.." || selection === "NEXT PAGE"){
        appendOutput("\nNO MORE PAGES AVAILABLE.\n");
        showPersonnelMenu();
        return;
      }
      if(agents.hasOwnProperty(selection)){
        lastSelectedAgent = selection;
        if(agents[selection] === "blocked"){
          appendOutput("\nERROR: FILE BLOCKED\n");
          promptInput("PLEASE ENTER PASSCODE\n> ", (pass) => {
            if(pass === passcode){
              appendOutput("\nPASSCODE VERIFIED\nACCESS GRANTED\n");
              showAgentFile(selection);
            } else {
              appendOutput("\nPASSCODE DENIED\nACCESS DENIED\n");
              showPersonnelMenu();
            }
          }, true);
        } else {
          showAgentFile(selection);
        }
      } else {
        appendOutput("\nINVALID SELECTION. TRY AGAIN.\n");
        showPersonnelMenu();
      }
    });
  }

  // Show agent file (link)
  function showAgentFile(agent){
    clearTerminal();
    appendOutput(`--- ${agent} FILE ---\n`);
    const link = agents[agent];
    if(link === "blocked"){
      appendOutput("[ERROR: FILE STILL BLOCKED]\n");
      showPersonnelMenu();
      return;
    }
    appendOutput(`Document link: ${link}\n`);
    appendOutput("Press ENTER to return to PERSONNEL MENU.\n");

    promptInput("> ", () => {
      showPersonnelMenu();
    });
  }

  window.onload = startTerminal;
</script>

</body>
</html>
