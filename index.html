// Full SD Database Website Code (Restored Login, Clearance, and SCP Wiki Search Integration)

import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

export default function SDDatabase() {
  const [clearance, setClearance] = useState(0);
  const [codename, setCodename] = useState("");
  const [inputClearance, setInputClearance] = useState("");
  const [inputCodename, setInputCodename] = useState("");
  const [scpSearch, setScpSearch] = useState("");
  const [scpData, setScpData] = useState(null);

  const handleLogin = () => {
    const level = parseInt(inputClearance);
    if ([3, 4, 5].includes(level)) {
      setClearance(level);
      setCodename(inputCodename);
    }
  };

  const handleScpSearch = async () => {
    try {
      const searchTerm = scpSearch.toLowerCase().replace(/\s+/g, "-");
      const url = `https://scp-wiki.wikidot.com/${searchTerm}`;
      const response = await fetch(`/api/proxy?url=${encodeURIComponent(url)}`);
      const text = await response.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');
      const content = doc.querySelector("#page-content");
      setScpData(content ? content.innerText.slice(0, 2000) : "SCP not found or content blocked.");
    } catch {
      setScpData("Failed to fetch SCP information.");
    }
  };

  if (!codename) {
    return (
      <div className="flex flex-col items-center justify-center h-screen bg-black text-white">
        <h1 className="text-6xl font-bold mb-6">SD DATABASE</h1>
        <input
          className="mb-2 p-2 bg-zinc-800 text-white rounded"
          placeholder="Enter Clearance Level"
          onChange={(e) => setInputClearance(e.target.value)}
        />
        <input
          className="mb-4 p-2 bg-zinc-800 text-white rounded"
          placeholder="Enter Codename"
          onChange={(e) => setInputCodename(e.target.value)}
        />
        <Button onClick={handleLogin}>LOGIN</Button>
      </div>
    );
  }

  return (
    <div className="p-6 text-white">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-5xl font-extrabold">SD DATABASE</h1>
        <p className="text-xl">Codename: {codename} | Level: {clearance}</p>
      </div>

      <div className="my-6">
        <h2 className="text-3xl font-bold mb-2">SCP DATABASE</h2>
        <input
          className="p-2 w-full md:w-1/2 bg-zinc-800 text-white rounded"
          placeholder="Search SCP (e.g. SCP-173)"
          value={scpSearch}
          onChange={(e) => setScpSearch(e.target.value)}
        />
        <Button className="ml-2" onClick={handleScpSearch}>Search</Button>
        {scpData && (
          <Card className="bg-zinc-800 mt-4">
            <CardContent className="p-4 whitespace-pre-wrap">
              <p>{scpData}</p>
            </CardContent>
          </Card>
        )}
      </div>

      {/* Keep other content (Lore, SD Teams, Personnel, etc.) here */}
    </div>
  );
}
